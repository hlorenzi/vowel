(()=>{"use strict";const e={context:void 0,registry:void 0};function t(t){e.context=t}const n=(Symbol("solid-proxy"),Symbol("solid-track"),Symbol("solid-dev-component"),{equals:(e,t)=>e===t});let o=null,r=C;const i=1,s=2,a={owned:null,cleanups:null,context:null,owner:null};var l=null;let c=null,u=null,f=null,d=null,h=null,m=null,g=0;const[x,y]=p(!1);function p(e,t){const o={value:e,observers:null,observerSlots:null,comparator:(t=t?Object.assign({},n,t):n).equals||void 0};return[M.bind(o),e=>("function"==typeof e&&(e=c&&c.running&&c.sources.has(o)?e(o.tValue):e(o.value)),B(o,e))]}function v(e,t,n){const o=q(e,t,!1,i);u&&c&&c.running?h.push(o):T(o)}function w(e,t,n){r=D;const o=q(e,t,!1,i),s=P&&(a=P,l&&l.context&&void 0!==l.context[a.id]?l.context[a.id]:a.defaultValue);var a;s&&(o.suspense=s),n&&n.render||(o.user=!0),m?m.push(o):T(o)}function b(e,t,o){o=o?Object.assign({},n,o):n;const r=q(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=o.equals||void 0,u&&c&&c.running?(r.tState=i,h.push(r)):T(r),M.bind(r)}function F(e){if(null===d)return e();const t=d;d=null;try{return e()}finally{d=t}}function S(e){w((()=>F(e)))}function A(e){const t=b(e),n=b((()=>O(t())));return n.toArray=()=>{const e=n();return Array.isArray(e)?e:null!=e?[e]:[]},n}let P;function M(){const e=c&&c.running;if(this.sources&&(e?this.tState:this.state))if((e?this.tState:this.state)===i)T(this);else{const e=h;h=null,R((()=>G(this)),!1),h=e}if(d){const e=this.observers?this.observers.length:0;d.sources?(d.sources.push(this),d.sourceSlots.push(e)):(d.sources=[this],d.sourceSlots=[e]),this.observers?(this.observers.push(d),this.observerSlots.push(d.sources.length-1)):(this.observers=[d],this.observerSlots=[d.sources.length-1])}return e&&c.sources.has(this)?this.tValue:this.value}function B(e,t,n){let o=c&&c.running&&c.sources.has(e)?e.tValue:e.value;if(!e.comparator||!e.comparator(o,t)){if(c){const o=c.running;(o||!n&&c.sources.has(e))&&(c.sources.add(e),e.tValue=t),o||(e.value=t)}else e.value=t;e.observers&&e.observers.length&&R((()=>{for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t],o=c&&c.running;o&&c.disposed.has(n)||((o?n.tState:n.state)||(n.pure?h.push(n):m.push(n),n.observers&&N(n)),o?n.tState=i:n.state=i)}if(h.length>1e6)throw h=[],new Error}),!1)}return t}function T(e){if(!e.fn)return;$(e);const t=l,n=d,o=g;d=l=e,k(e,c&&c.running&&c.sources.has(e)?e.tValue:e.value,o),c&&!c.running&&c.sources.has(e)&&queueMicrotask((()=>{R((()=>{c&&(c.running=!0),d=l=e,k(e,e.tValue,o),d=l=null}),!1)})),d=n,l=t}function k(e,t,n){let o;try{o=e.fn(t)}catch(t){return e.pure&&(c&&c.running?(e.tState=i,e.tOwned&&e.tOwned.forEach($),e.tOwned=void 0):(e.state=i,e.owned&&e.owned.forEach($),e.owned=null)),e.updatedAt=n+1,z(t)}(!e.updatedAt||e.updatedAt<=n)&&(null!=e.updatedAt&&"observers"in e?B(e,o,!0):c&&c.running&&e.pure?(c.sources.add(e),e.tValue=o):e.value=o,e.updatedAt=n)}function q(e,t,n,o=i,r){const s={fn:e,state:o,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:l,context:l?l.context:null,pure:n};if(c&&c.running&&(s.state=0,s.tState=o),null===l||l!==a&&(c&&c.running&&l.pure?l.tOwned?l.tOwned.push(s):l.tOwned=[s]:l.owned?l.owned.push(s):l.owned=[s]),f){const[e,t]=p(void 0,{equals:!1}),n=f(s.fn,t);!function(e){null===l||(null===l.cleanups?l.cleanups=[e]:l.cleanups.push(e))}((()=>n.dispose()));const o=()=>function(e){if(c&&c.running)return e(),c.done;const t=d,n=l;return Promise.resolve().then((()=>{let o;return d=t,l=n,(u||P)&&(o=c||(c={sources:new Set,effects:[],promises:new Set,disposed:new Set,queue:new Set,running:!0}),o.done||(o.done=new Promise((e=>o.resolve=e))),o.running=!0),R(e,!1),d=l=null,o?o.done:void 0}))}(t).then((()=>r.dispose())),r=f(s.fn,o);s.fn=t=>(e(),c&&c.running?r.track(t):n.track(t))}return s}function I(e){const t=c&&c.running;if(0===(t?e.tState:e.state))return;if((t?e.tState:e.state)===s)return G(e);if(e.suspense&&F(e.suspense.inFallback))return e.suspense.effects.push(e);const n=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<g);){if(t&&c.disposed.has(e))return;(t?e.tState:e.state)&&n.push(e)}for(let o=n.length-1;o>=0;o--){if(e=n[o],t){let t=e,r=n[o+1];for(;(t=t.owner)&&t!==r;)if(c.disposed.has(t))return}if((t?e.tState:e.state)===i)T(e);else if((t?e.tState:e.state)===s){const t=h;h=null,R((()=>G(e,n[0])),!1),h=t}}}function R(e,t){if(h)return e();let n=!1;t||(h=[]),m?n=!0:m=[],g++;try{const t=e();return function(e){if(h&&(u&&c&&c.running?function(e){for(let t=0;t<e.length;t++){const n=e[t],o=c.queue;o.has(n)||(o.add(n),u((()=>{o.delete(n),R((()=>{c.running=!0,I(n)}),!1),c&&(c.running=!1)})))}}(h):C(h),h=null),e)return;let t;if(c)if(c.promises.size||c.queue.size){if(c.running)return c.running=!1,c.effects.push.apply(c.effects,m),m=null,void y(!0)}else{const e=c.sources,n=c.disposed;m.push.apply(m,c.effects),t=c.resolve;for(const e of m)"tState"in e&&(e.state=e.tState),delete e.tState;c=null,R((()=>{for(const e of n)$(e);for(const t of e){if(t.value=t.tValue,t.owned)for(let e=0,n=t.owned.length;e<n;e++)$(t.owned[e]);t.tOwned&&(t.owned=t.tOwned),delete t.tValue,delete t.tOwned,t.tState=0}y(!1)}),!1)}const n=m;m=null,n.length&&R((()=>r(n)),!1),t&&t()}(n),t}catch(e){n||(m=null),h=null,z(e)}}function C(e){for(let t=0;t<e.length;t++)I(e[t])}function D(n){let o,r=0;for(o=0;o<n.length;o++){const e=n[o];e.user?n[r++]=e:I(e)}if(e.context){if(e.count)return e.effects||(e.effects=[]),void e.effects.push(...n.slice(0,r));e.effects&&(n=[...e.effects,...n],r+=e.effects.length,delete e.effects),t()}for(o=0;o<r;o++)I(n[o])}function G(e,t){const n=c&&c.running;n?e.tState=0:e.state=0;for(let o=0;o<e.sources.length;o+=1){const r=e.sources[o];if(r.sources){const e=n?r.tState:r.state;e===i?r!==t&&(!r.updatedAt||r.updatedAt<g)&&I(r):e===s&&G(r,t)}}}function N(e){const t=c&&c.running;for(let n=0;n<e.observers.length;n+=1){const o=e.observers[n];(t?o.tState:o.state)||(t?o.tState=s:o.state=s,o.pure?h.push(o):m.push(o),o.observers&&N(o))}}function $(e){let t;if(e.sources)for(;e.sources.length;){const t=e.sources.pop(),n=e.sourceSlots.pop(),o=t.observers;if(o&&o.length){const e=o.pop(),r=t.observerSlots.pop();n<o.length&&(e.sourceSlots[r]=n,o[n]=e,t.observerSlots[n]=r)}}if(c&&c.running&&e.pure){if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)$(e.tOwned[t]);delete e.tOwned}E(e,!0)}else if(e.owned){for(t=e.owned.length-1;t>=0;t--)$(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}c&&c.running?e.tState=0:e.state=0}function E(e,t){if(t||(e.tState=0,c.disposed.add(e)),e.owned)for(let t=0;t<e.owned.length;t++)E(e.owned[t])}function W(e,t,n){try{for(const n of t)n(e)}catch(e){z(e,n&&n.owner||null)}}function z(e,t=l){const n=o&&t&&t.context&&t.context[o],r=function(e){return e instanceof Error?e:new Error("string"==typeof e?e:"Unknown error",{cause:e})}(e);if(!n)throw r;m?m.push({fn(){W(r,n,t)},state:i}):W(r,n,t)}function O(e){if("function"==typeof e&&!e.length)return O(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const o=O(e[n]);Array.isArray(o)?t.push.apply(t,o):t.push(o)}return t}return e}function U(e,t){return function(t){let n;return v((()=>n=F((()=>(l.context={...l.context,[e]:t.value},A((()=>t.children)))))),void 0),n}}Symbol("fallback");function L(e,t){return F((()=>e(t||{})))}function j(e){const t=e.keyed,n=b((()=>e.when),void 0,{equals:(e,n)=>t?e===n:!e==!n});return b((()=>{const o=n();if(o){const r=e.children;return"function"==typeof r&&r.length>0?F((()=>r(t?o:()=>{if(!F(n))throw`Stale read from <${"Show"}>.`;return e.when}))):r}return e.fallback}),void 0,void 0)}!function(e,t){const n=Symbol("context");U(n)}(),Object.create(null),Object.create(null);const V="_$DX_DELEGATE";function H(e,t,n){let o;const r=()=>{const t=document.createElement("template");return t.innerHTML=e,n?t.content.firstChild.firstChild:t.content.firstChild},i=t?()=>F((()=>document.importNode(o||(o=r()),!0))):()=>(o||(o=r())).cloneNode(!0);return i.cloneNode=i,i}function Q(e,t=window.document){const n=t[V]||(t[V]=new Set);for(let o=0,r=e.length;o<r;o++){const r=e[o];n.has(r)||(n.add(r),t.addEventListener(r,Y))}}function _(e,t,n){return F((()=>e(t,n)))}function X(e,t,n,o){if(void 0===n||o||(o=[]),"function"!=typeof t)return J(e,t,o,n);v((o=>J(e,t(),o,n)),o)}function Y(t){const n=`$$${t.type}`;let o=t.composedPath&&t.composedPath()[0]||t.target;for(t.target!==o&&Object.defineProperty(t,"target",{configurable:!0,value:o}),Object.defineProperty(t,"currentTarget",{configurable:!0,get:()=>o||document}),e.registry&&!e.done&&(e.done=_$HY.done=!0);o;){const e=o[n];if(e&&!o.disabled){const r=o[`${n}Data`];if(void 0!==r?e.call(o,r,t):e.call(o,t),t.cancelBubble)return}o=o._$host||o.parentNode||o.host}}function J(t,n,o,r,i){if(e.context){!o&&(o=[...t.childNodes]);let e=[];for(let t=0;t<o.length;t++){const n=o[t];8===n.nodeType&&"!$"===n.data.slice(0,2)?n.remove():e.push(n)}o=e}for(;"function"==typeof o;)o=o();if(n===o)return o;const s=typeof n,a=void 0!==r;if(t=a&&o[0]&&o[0].parentNode||t,"string"===s||"number"===s){if(e.context)return o;if("number"===s&&(n=n.toString()),a){let e=o[0];e&&3===e.nodeType?e.data=n:e=document.createTextNode(n),o=ee(t,o,r,e)}else o=""!==o&&"string"==typeof o?t.firstChild.data=n:t.textContent=n}else if(null==n||"boolean"===s){if(e.context)return o;o=ee(t,o,r)}else{if("function"===s)return v((()=>{let e=n();for(;"function"==typeof e;)e=e();o=J(t,e,o,r)})),()=>o;if(Array.isArray(n)){const s=[],l=o&&Array.isArray(o);if(K(s,n,o,i))return v((()=>o=J(t,s,o,r,!0))),()=>o;if(e.context){if(!s.length)return o;for(let e=0;e<s.length;e++)if(s[e].parentNode)return o=s}if(0===s.length){if(o=ee(t,o,r),a)return o}else l?0===o.length?Z(t,s,r):function(e,t,n){let o=n.length,r=t.length,i=o,s=0,a=0,l=t[r-1].nextSibling,c=null;for(;s<r||a<i;)if(t[s]!==n[a]){for(;t[r-1]===n[i-1];)r--,i--;if(r===s){const t=i<o?a?n[a-1].nextSibling:n[i-a]:l;for(;a<i;)e.insertBefore(n[a++],t)}else if(i===a)for(;s<r;)c&&c.has(t[s])||t[s].remove(),s++;else if(t[s]===n[i-1]&&n[a]===t[r-1]){const o=t[--r].nextSibling;e.insertBefore(n[a++],t[s++].nextSibling),e.insertBefore(n[--i],o),t[r]=n[i]}else{if(!c){c=new Map;let e=a;for(;e<i;)c.set(n[e],e++)}const o=c.get(t[s]);if(null!=o)if(a<o&&o<i){let l,u=s,f=1;for(;++u<r&&u<i&&null!=(l=c.get(t[u]))&&l===o+f;)f++;if(f>o-a){const r=t[s];for(;a<o;)e.insertBefore(n[a++],r)}else e.replaceChild(n[a++],t[s++])}else s++;else t[s++].remove()}}else s++,a++}(t,o,s):(o&&ee(t),Z(t,s));o=s}else if(n.nodeType){if(e.context&&n.parentNode)return o=a?[n]:n;if(Array.isArray(o)){if(a)return o=ee(t,o,r,n);ee(t,o,null,n)}else null!=o&&""!==o&&t.firstChild?t.replaceChild(n,t.firstChild):t.appendChild(n);o=n}else console.warn("Unrecognized value. Skipped inserting",n)}return o}function K(e,t,n,o){let r=!1;for(let i=0,s=t.length;i<s;i++){let s,a=t[i],l=n&&n[i];if(null==a||!0===a||!1===a);else if("object"==(s=typeof a)&&a.nodeType)e.push(a);else if(Array.isArray(a))r=K(e,a,l)||r;else if("function"===s)if(o){for(;"function"==typeof a;)a=a();r=K(e,Array.isArray(a)?a:[a],Array.isArray(l)?l:[l])||r}else e.push(a),r=!0;else{const t=String(a);l&&3===l.nodeType&&l.data===t?e.push(l):e.push(document.createTextNode(t))}}return r}function Z(e,t,n=null){for(let o=0,r=t.length;o<r;o++)e.insertBefore(t[o],n)}function ee(e,t,n,o){if(void 0===n)return e.textContent="";const r=o||document.createTextNode("");if(t.length){let o=!1;for(let i=t.length-1;i>=0;i--){const s=t[i];if(r!==s){const t=s.parentNode===e;o||i?t&&s.remove():t?e.replaceChild(r,s):e.insertBefore(r,n)}else o=!0}}else e.insertBefore(r,n);return[r]}class te{static async create(){const e=new AudioContext({sampleRate:11e3});return await e.audioWorklet.addModule("build/audioWorklet.js"),new te(e)}constructor(e){this.ctx=e,this.waveformCaptureNode=new AudioWorkletNode(this.ctx,"waveformCapture"),this.waveformCaptureNode.port.onmessage=e=>this.captureWaveform(e),this.waveformCaptureNode.connect(this.ctx.destination),this.nodeAnalyser=this.ctx.createAnalyser(),this.nodeAnalyser.fftSize=2048,this.nodeAnalyser.maxDecibels=-20,this.nodeAnalyser.minDecibels=-90,this.nodeAnalyser.smoothingTimeConstant=.8,this.nodeAnalyserData=new Uint8Array(this.nodeAnalyser.fftSize),this.nodeAnalyserTimeDomainData=new Float32Array(this.nodeAnalyser.fftSize),this.nodeAnalyser.connect(this.waveformCaptureNode),this.waveformBuffer=new Float32Array(8e4),this.waveformBufferIndex=0,this.nodeMicFilter=this.ctx.createBiquadFilter(),this.nodeMicFilter.type="lowpass",this.nodeMicFilter.frequency.value=3e3,this.nodeMicFilter.Q.value=25,this.nodeMicFilter.connect(this.nodeAnalyser),this.nodeFormant1Gain=this.ctx.createGain(),this.nodeFormant1Gain.gain.value=0,this.nodeFormant1Gain.connect(this.nodeAnalyser),this.nodeFormant1Gain.connect(this.ctx.destination),this.nodeFormant1Filter=this.ctx.createBiquadFilter(),this.nodeFormant1Filter.type="bandpass",this.nodeFormant1Filter.frequency.value=0,this.nodeFormant1Filter.Q.value=5,this.nodeFormant1Filter.connect(this.nodeFormant1Gain),this.nodeFormant2Gain=this.ctx.createGain(),this.nodeFormant2Gain.gain.value=0,this.nodeFormant2Gain.connect(this.nodeAnalyser),this.nodeFormant2Gain.connect(this.ctx.destination),this.nodeFormant2Filter=this.ctx.createBiquadFilter(),this.nodeFormant2Filter.type="bandpass",this.nodeFormant2Filter.frequency.value=0,this.nodeFormant2Filter.Q.value=5,this.nodeFormant2Filter.connect(this.nodeFormant2Gain),this.nodeFormant3Gain=this.ctx.createGain(),this.nodeFormant3Gain.gain.value=0,this.nodeFormant3Gain.connect(this.nodeAnalyser),this.nodeFormant3Gain.connect(this.ctx.destination),this.nodeFormant3Filter=this.ctx.createBiquadFilter(),this.nodeFormant3Filter.type="bandpass",this.nodeFormant3Filter.frequency.value=0,this.nodeFormant3Filter.Q.value=5,this.nodeFormant3Filter.connect(this.nodeFormant3Gain),this.nodeFormant4Gain=this.ctx.createGain(),this.nodeFormant4Gain.gain.value=0,this.nodeFormant4Gain.connect(this.nodeAnalyser),this.nodeFormant4Gain.connect(this.ctx.destination),this.nodeFormant4Filter=this.ctx.createBiquadFilter(),this.nodeFormant4Filter.type="bandpass",this.nodeFormant4Filter.frequency.value=0,this.nodeFormant4Filter.Q.value=5,this.nodeFormant4Filter.connect(this.nodeFormant4Gain),this.nodeSource=this.ctx.createOscillator(),this.nodeSource.type="sawtooth",this.nodeSource.frequency.value=90,this.nodeSource.connect(this.nodeFormant1Filter),this.nodeSource.connect(this.nodeFormant2Filter),this.nodeSource.start(),this.recordingBuffer=this.ctx.createBuffer(1,8e4,this.ctx.sampleRate),this.recordingPlaybackStartTime=0,this.cachedFormants=[]}resume(){this.ctx.resume()}setGain(e){const t=.5;this.nodeFormant1Gain.gain.value=e*t,this.nodeFormant2Gain.gain.value=e*t*.8,this.nodeFormant3Gain.gain.value=e*t*.5,this.nodeFormant4Gain.gain.value=e*t*.2}setFrequencies(e,t){e=Math.max(0,Math.min(5e3,e)),t=Math.max(0,Math.min(5e3,t)),this.nodeFormant1Filter.frequency.value=e,this.nodeFormant2Filter.frequency.value=t,this.nodeFormant3Filter.frequency.value=2700,this.nodeFormant4Filter.frequency.value=3500}captureWaveform(e){const t=e.data.buffer,n=e.data.length;for(let e=0;e<n;e++){const n=(this.waveformBufferIndex+e)%this.waveformBuffer.length;this.waveformBuffer[n]=t[e]}this.waveformBufferIndex=(this.waveformBufferIndex+n)%this.waveformBuffer.length}getWaveform(e){const t=Math.max(0,e>this.waveformBufferIndex?this.waveformBuffer.length-e+this.waveformBufferIndex:this.waveformBufferIndex-e),n=new Float32Array(t);for(let o=0;o<t;o++)n[o]=this.waveformBuffer[(e+o)%this.waveformBuffer.length];return n}getWaveformLatest(e){return this.getWaveform((this.waveformBufferIndex+this.waveformBuffer.length-e)%this.waveformBuffer.length)}cacheFormants(e){this.cachedFormants=e}getCachedFormants(){return this.cachedFormants}getAnalyserData(){return this.nodeAnalyser.getByteFrequencyData(this.nodeAnalyserData),this.nodeAnalyserData}getAnalyserTimeData(){return this.nodeAnalyser.getFloatTimeDomainData(this.nodeAnalyserTimeDomainData),this.nodeAnalyserTimeDomainData}playRecording(){this.nodeRecordingSrc&&(this.nodeRecordingSrc.stop(),this.nodeRecordingSrc.disconnect(),this.nodeRecordingSrc=void 0),this.nodeRecordingSrc=this.ctx.createBufferSource(),this.nodeRecordingSrc.buffer=this.recordingBuffer,this.nodeRecordingSrc.connect(this.nodeAnalyser),this.nodeRecordingSrc.connect(this.ctx.destination),this.nodeRecordingSrc.start(),this.recordingPlaybackStartTime=this.ctx.currentTime}async toggleMic(){if(this.nodeMicSrc)return this.nodeMicSrc.disconnect(),void(this.nodeMicSrc=void 0);try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});this.nodeMicSrc=this.ctx.createMediaStreamSource(e),this.nodeMicSrc.connect(this.nodeMicFilter)}catch(e){throw window.alert("Could not open the microphone.\n\n"+e),e}}}const ne=200,oe=1200,re=500,ie=3500,se="#284",ae="#02f",le="#f20",ce=H("<canvas>"),ue=10;function fe(e){const t={canvas:void 0,ctx:void 0,synth:e.synth,mouseDown:!1,mousePosNormalized:{x:0,y:0},mousePosFormants:{f1:0,f2:0},mousePath:[],formantPath:[]};return S((()=>{t.ctx=t.canvas.getContext("2d"),t.canvas.addEventListener("mousedown",(e=>ge(t,e))),window.addEventListener("mousemove",(e=>xe(t,e))),window.addEventListener("mouseup",(e=>ye(t,e))),t.canvas.addEventListener("touchstart",(e=>ge(t,e))),window.addEventListener("touchend",(e=>ye(t,e))),window.addEventListener("touchcancel",(e=>ye(t,e))),window.addEventListener("touchmove",(e=>xe(t,e))),window.requestAnimationFrame((()=>we(e.synth,t)))})),(()=>{const e=ce(),n=t.canvas;return"function"==typeof n?_(n,e):t.canvas=e,e.style.setProperty("width","100%"),e.style.setProperty("height","50dvh"),e.style.setProperty("border-radius","0.25em"),e})()}function de(e,t){const n=e.canvas.getBoundingClientRect(),[o,r]="touches"in t?[t.touches.item(0)?.clientX??0,t.touches.item(0)?.clientY??0]:[t.clientX,t.clientY],i=(o-n.x)/n.width,s=(r-n.y)/n.height;if(e.mousePosNormalized={x:i,y:s},e.mousePosFormants={f1:Math.floor(he(s,ne,oe)),f2:Math.floor(he(1-i,re,ie))},e.mouseDown)for(e.mousePath.push({...e.mousePosNormalized,timer:1});e.mousePath.length>200;)e.mousePath.splice(0,1);e.synth.setFrequencies(e.mousePosFormants.f1,e.mousePosFormants.f2)}function he(e,t,n){return t+(n-t)*((Math.pow(ue,e)-1)/(ue-1))}function me(e,t,n){const o=(e-t)/(n-t);return Math.log((ue-1)*o+1)/Math.log(ue)}function ge(e,t){t.preventDefault(),e.mouseDown=!0,e.synth.resume(),e.synth.setGain(1),e.mousePath=[],de(e,t)}function xe(e,t){e.mouseDown&&t.preventDefault(),de(e,t)}function ye(e,t){e.mouseDown&&t.preventDefault(),e.mouseDown=!1,e.synth.setGain(0),de(e,t)}const pe=[{symbol:"i",f1:255,f2:2890},{symbol:"u",f1:260,f2:593},{symbol:"a",f1:1072,f2:1449},{symbol:"o",f1:500,f2:800},{symbol:"ɔ",f1:664,f2:907},{symbol:"ɛ",f1:709,f2:2105},{symbol:"e",f1:408,f2:2253},{symbol:"ə",f1:600,f2:1200},{symbol:"ɪ",f1:347,f2:2629},{symbol:"ʊ",f1:434,f2:1024},{symbol:"ʌ",f1:731,f2:1127},{symbol:"ɑ",f1:970,f2:984},{symbol:"æ",f1:902,f2:1730},{symbol:"y",f1:252,f2:2120}],ve=window.matchMedia("(pointer: coarse)").matches;function we(e,t){window.requestAnimationFrame((()=>we(e,t)));const n=window.devicePixelRatio,o=t.canvas.getBoundingClientRect(),r=Math.round(n*o.right)-Math.round(n*o.left),i=Math.round(n*o.bottom)-Math.round(n*o.top);t.canvas.width=r,t.canvas.height=i,t.ctx.save(),t.ctx.translate(.5,.5),t.ctx.clearRect(0,0,r,i),t.ctx.fillStyle="#eee",t.ctx.fillRect(0,0,r,i),t.ctx.fillStyle="#ccc",t.ctx.beginPath(),t.ctx.moveTo(r,i);for(let e=re;e<=oe;e+=100){const n=r-me(e,re,ie)*r,o=me(e,ne,oe)*i;t.ctx.lineTo(n,o)}t.ctx.fill(),t.ctx.lineWidth=1,t.ctx.strokeStyle="#aaa",t.ctx.fillStyle="#aaa",t.ctx.font=(ve?"1.5em":"0.75em")+" Times New Roman",t.ctx.fillStyle="#000",t.ctx.textAlign="left",t.ctx.textBaseline="top";for(let e=re+500;e<ie;e+=500){const n=Math.floor(r-me(e,re,ie)*r);t.ctx.beginPath(),t.ctx.moveTo(n,0),t.ctx.lineTo(n,i),t.ctx.stroke(),t.ctx.fillText(e==re+500?`F2 = ${e} Hz`:`${e}`,n+2,2)}t.ctx.textBaseline="bottom";for(let e=ne+200;e<=oe;e+=200){const n=Math.floor(me(e,ne,oe)*i);t.ctx.beginPath(),t.ctx.moveTo(0,n),t.ctx.lineTo(r,n),t.ctx.stroke(),t.ctx.fillText(e==oe?`F1 = ${e} Hz`:`${e}`,2,n-2)}t.ctx.font=(ve?"2.5em":"2em")+" Times New Roman",t.ctx.fillStyle="#000",t.ctx.textAlign="center",t.ctx.textBaseline="middle";for(const e of pe){const n=Math.floor(r-me(e.f2,re,ie)*r),o=Math.floor(me(e.f1,ne,oe)*i);t.ctx.fillText(e.symbol,n,o)}t.ctx.strokeStyle=ae,t.ctx.lineWidth=2;for(let e=1;e<t.formantPath.length;e++){t.ctx.beginPath();const n=Math.max(0,t.formantPath[e].timer);t.ctx.globalAlpha=n;const o=t.formantPath[e-1],s=t.formantPath[e],a=(s.x-o.x)*r,l=(s.y-o.y)*i;Math.sqrt(a*a+l*l)<r/4&&(t.ctx.moveTo(o.x*r,o.y*i),t.ctx.lineTo(s.x*r,s.y*i),t.ctx.arc(o.x*r,o.y*i,2,0,2*Math.PI)),t.ctx.stroke(),t.ctx.globalAlpha=1}t.ctx.strokeStyle=se,t.ctx.lineWidth=2;for(let e=1;e<t.mousePath.length;e++){t.ctx.beginPath();const n=Math.max(0,t.mousePath[e].timer);t.ctx.globalAlpha=n;const o=t.mousePath[e-1],s=t.mousePath[e];t.ctx.moveTo(o.x*r,o.y*i),t.ctx.lineTo(s.x*r,s.y*i);const a=(s.x-o.x)*r,l=(s.y-o.y)*i,c=Math.sqrt(a*a+l*l),u=a/c,f=l/c,d=3;t.ctx.moveTo(o.x*r-f*d,o.y*i+u*d),t.ctx.lineTo(o.x*r+f*d,o.y*i-u*d),t.ctx.stroke(),t.ctx.globalAlpha=1}t.mousePath.forEach((e=>e.timer-=1/30)),t.mouseDown&&(t.ctx.strokeStyle=se,t.ctx.fillStyle=se,t.ctx.lineWidth=2,t.ctx.beginPath(),t.ctx.arc(t.mousePosNormalized.x*r,t.mousePosNormalized.y*i,2,0,2*Math.PI),t.ctx.stroke(),t.ctx.font=(ve?"1.5em":"0.75em")+" Times New Roman",t.ctx.textAlign="center",t.ctx.textBaseline="bottom",t.ctx.fillText(`(${t.mousePosFormants.f1.toFixed(0)}, ${t.mousePosFormants.f2.toFixed(0)} Hz)`,t.mousePosNormalized.x*r,t.mousePosNormalized.y*i+(ve?-120:-10)));const s=e.getCachedFormants();if(t.formantPath.forEach((e=>e.timer-=1/60)),s.length>=2){const e=s[0],n=s[1],o=Math.floor(r-me(n,re,ie)*r),a=Math.floor(me(e,ne,oe)*i);for(t.formantPath.push({x:o/r,y:a/i,timer:1});t.formantPath.length>100;)t.formantPath.splice(0,1);t.ctx.strokeStyle=ae,t.ctx.fillStyle=ae,t.ctx.lineWidth=2,t.ctx.beginPath(),t.ctx.arc(o,a,2,0,2*Math.PI),t.ctx.stroke(),t.ctx.font=(ve?"1.5em":"0.75em")+" Times New Roman",t.ctx.textAlign="center",t.ctx.textBaseline="bottom",t.ctx.fillText(`(${e.toFixed(0)}, ${n.toFixed(0)} Hz)`,o,a)}t.ctx.restore()}function be(e,t){const n=new Array(t).fill(0);if(e.length<=2)return n[1]=-1,n;const o=new Array(e.length).fill(0),r=new Array(e.length).fill(0),i=new Array(t).fill(0),s=e.length,a=t;let l=0;for(let t=1;t<=s;t++)l+=e[t-1]*e[t-1];let c=l/s;if(c<=0)return n;if(o[0]=e[0],s<2)return n;r[s-1-1]=e[s-1];for(let t=2;t<=s-1;t++)o[t-1]=e[t-1],r[t-1-1]=e[t-1];for(let e=1;e<=a;e++){let t=0,l=0;for(let n=1;n<=s-e;n++)t+=o[n-1]*r[n-1],l+=o[n-1]*o[n-1]+r[n-1]*r[n-1];if(l<=0)return n;n[e-1]=2*t/l,c*=1-n[e-1]*n[e-1];for(let t=1;t<=e-1;t++)n[t-1]=i[t-1]-n[e-1]*i[e-t-1];if(e<a){for(let t=1;t<=e;t++)i[t-1]=n[t-1];for(let t=1;t<=s-e-1;t++)o[t-1]-=i[e-1]*r[t-1],r[t-1]=r[t+1-1]-i[e-1]*o[t+1-1]}}for(let e=0;e<n.length;e++)n[e]*=-1;return n.unshift(1),n}function Fe(e){const t=[],n=new Array(e.length).fill(0),o=new Array(e.length).fill(0);let r=0,i=0;for(;e.length>3;){const s=e.length;n[s-1]=1,n[s-2]=1;let a=100;for(;Math.abs(n[s-1])+Math.abs(n[s-2])>1e-6&&a>0;){a--,n[0]=e[0],n[1]=e[1]+r*n[0];for(let t=2;t<s;t++)n[t]=e[t]+r*n[t-1]+i*n[t-2];o[0]=n[0],o[1]=n[1]+r*o[0];for(let e=2;e<s-1;e++)o[e]=n[e]+r*o[e-1]+i*o[e-2];r+=(-n[s-2]*o[s-3]+n[s-1]*o[s-4])/(o[s-3]*o[s-3]-o[s-2]*o[s-4]),i+=(-n[s-1]*o[s-3]+n[s-2]*o[s-2])/(o[s-3]*o[s-3]-o[s-2]*o[s-4])}t.push(...Se(-i,-r,1)),e=n.slice(0,s-2)}return 3==e.length?t.push(...Se(e[0],e[1],e[2])):t.push({real:-e[1]/e[0],imag:0}),t}function Se(e,t,n){const o=t*t-4*e*n,r=-t/(2*e);if(o<0){const t=Math.sqrt(-o)/(2*e);return[{real:r,imag:t},{real:r,imag:-t}]}{const t=Math.sqrt(o)/(2*e);return[{real:r+t,imag:0},{real:r-t,imag:0}]}}function Ae(e){return Math.sqrt(e.real*e.real+e.imag*e.imag)}function Pe(e,t){e+=1;const n=.5*(t+1),o=Math.exp(-12);return(Math.exp(-48*(e-n)*(e-n)/(t+1)/(t+1))-o)/(1-o)}function Me(e,t){const n=new Float32Array(e),o=1/t,r=Math.exp(-2*Math.PI*50*o);for(let t=e.length-1;t>=1;t--)n[t]-=r*n[t-1];return n}function Be(e){const t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=e[e.length-1-n];return t}function Te(e){return Ae(e)<=1?e:function(e,t){const n=t.imag*t.imag+t.real*t.real;return{real:(e.real*t.real-e.imag*t.imag)/n,imag:(e.imag*t.real-e.real*t.imag)/n}}({imag:0,real:1},{real:(t=e).real,imag:-t.imag});var t}function ke(e,t){const n=t/2,o=e.map((e=>Math.abs(Math.atan2(e.imag,e.real))*n/Math.PI)),r=e.map((e=>-Math.log(Ae(e))*n/Math.PI*2)),i=[];for(let e=0;e<o.length;e++){const t=o[e],s=r[e];t>50&&t<n-50&&t<3500&&i.push({frequency:t,bandwidth:s})}return i.sort(((e,t)=>e.frequency-t.frequency)),i}const qe=H("<canvas>");function Ie(e){let t,n;return S((()=>{n=t.getContext("2d"),window.requestAnimationFrame((()=>Ce(e.synth,n)))})),(()=>{const e=qe();return"function"==typeof t?_(t,e):t=e,e.style.setProperty("width","100%"),e.style.setProperty("height","15dvh"),e.style.setProperty("border-radius","0.25em"),e})()}function Re(e,t){const n=ne-100,o=(e-n)/(ie+500-n);return 10+(t-20)*(Math.log(9*o+1)/Math.log(10))}function Ce(e,t){requestAnimationFrame((()=>Ce(e,t)));const n=window.devicePixelRatio,o=t.canvas.getBoundingClientRect(),r=Math.round(n*o.right)-Math.round(n*o.left),i=Math.round(n*o.bottom)-Math.round(n*o.top);t.canvas.width=r,t.canvas.height=i;const s=e.getAnalyserData();t.save(),t.translate(.5,.5),t.fillStyle="#eee",t.fillRect(0,0,r,i),t.lineWidth=1,t.strokeStyle="#aaa",t.fillStyle="#aaa",t.font="0.75em Times New Roman",t.fillStyle="#000",t.textAlign="left",t.textBaseline="top";for(let e=re;e<=ie;e+=500){const n=Math.floor(Re(e,r));t.beginPath(),t.moveTo(n,0),t.lineTo(n,i),t.stroke(),t.fillText(e+" Hz",n+2,2)}t.lineWidth=2,t.strokeStyle=le,t.beginPath();for(let n=0;n<s.length;n++){const o=n/s.length*(e.ctx.sampleRate/1);if(o<ne-100)continue;if(o>ie+500)break;const a=i-s[n]/255*i,l=Re(o,r);t.moveTo(l,i),t.lineTo(l,a)}t.stroke();const a=e.getWaveformLatest(Math.floor(.05*e.ctx.sampleRate));t.lineWidth=1,t.strokeStyle="#0008",t.beginPath(),t.moveTo(0,i/2);for(let e=0;e<a.length;e++){const n=i/2-a[e]*i/2,o=10+(r-20)*(e/a.length);t.lineTo(o,n)}t.lineTo(r,i/2),t.stroke();const l=function(e,t){if(e.every((e=>0===e)))return[];console.log("== extractFormants =="),console.log("samplingFrequency",t,"Hz"),console.log("sample length",e.length,"samples =",e.length/t,"seconds");const n=ke(Fe(Be(be(Me(e,t).map(((t,n)=>t*Pe(n,e.length))),10))).filter((e=>e.imag>=0)).map((e=>Te(e))),t);return console.log("formants",n.map((e=>e.frequency.toFixed(0).padStart(4," "))).join(", "),"Hz",n),n.map((e=>e.frequency))}(a,e.ctx.sampleRate);e.cacheFormants(l),t.lineWidth=2,t.strokeStyle=ae,t.globalAlpha=.75,t.beginPath();for(let e=0;e<l.length;e++){const n=Re(l[e],r);t.moveTo(n,0),t.lineTo(n,i)}t.stroke(),t.globalAlpha=1,t.restore()}function De(e,t,n){for(var o=0;o<n.length;o++)e.setUint8(t+o,n.charCodeAt(o))}const Ge=H("<canvas>"),Ne=H("<br>"),$e=H("<button>Record"),Ee=H("<button>Play"),We=H("<button>Export .wav"),ze=H("<button>Import .wav");function Oe(e){const t={canvas:void 0,ctx:void 0,synth:e.synth,sampleBuffer:new Float32Array(e.synth.recordingBuffer.length),recording:!1,recordingIndex:0,waveformBufferIndex:0,playing:!1,playingIndex:0};return S((()=>{t.ctx=t.canvas.getContext("2d"),window.requestAnimationFrame((()=>Ve(t)))})),[(()=>{const e=Ge(),n=t.canvas;return"function"==typeof n?_(n,e):t.canvas=e,e.style.setProperty("width","100%"),e.style.setProperty("height","15dvh"),e.style.setProperty("border-radius","0.25em"),e})(),Ne(),(()=>{const e=$e();return e.$$click=()=>function(e){e.recording?Ue(e):(e.sampleBuffer.fill(0),e.recording=!0,e.recordingIndex=0,e.waveformBufferIndex=e.synth.waveformBufferIndex,window.requestAnimationFrame((()=>Le(e))))}(t),e})()," ",(()=>{const e=Ee();return e.$$click=()=>function(e){e.playing=!0,e.playingIndex=0,e.synth.playRecording(),window.requestAnimationFrame((()=>je(e)))}(t),e})()," ",(()=>{const e=We();return e.$$click=()=>function(e){const t=(i=e.sampleBuffer.slice(0,e.recordingIndex),s=e.synth.ctx.sampleRate,function(e,t,n,o,r){var i=new ArrayBuffer(44+2*e.length),s=new DataView(i);return De(s,0,"RIFF"),s.setUint32(4,36+2*e.length,!0),De(s,8,"WAVE"),De(s,12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,1,!0),s.setUint16(22,1,!0),s.setUint32(24,n,!0),s.setUint32(28,2*n,!0),s.setUint16(32,2,!0),s.setUint16(34,16,!0),De(s,36,"data"),s.setUint32(40,2*e.length,!0),function(e,t,n){for(var o=0;o<n.length;o++,t+=2){const r=Math.max(-1,Math.min(1,n[o]));e.setInt16(t,32767*r,!0)}}(s,44,e),i}(i,0,s)),n=new Blob([t],{type:"octet/stream"}),o=window.URL.createObjectURL(n),r=document.createElement("a");var i,s;r.setAttribute("href",o),r.setAttribute("download","recording.wav"),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}(t),e})()," ",(()=>{const e=ze();return e.$$click=async()=>async function(e){const t=(await window.showOpenFilePicker({multiple:!1,types:[{description:"Audio files",accept:{"audio/wav":[".wav"]}}]}))[0],n=await t.getFile(),o=await n.arrayBuffer(),r=await e.synth.ctx.decodeAudioData(o),i=r.getChannelData(0).slice(0,e.sampleBuffer.length);e.sampleBuffer.fill(0),e.sampleBuffer.set(i,0),e.recordingIndex=i.length,Ue(e),function(e,t){console.log("testExtractFormants"),console.log("samplingFrequency",t),console.log("data",e);const n=Me(new Float32Array(e),t);console.log("preemphasized",n);const o=new Array(n.length).fill(0).map(((e,t)=>Pe(t,n.length)));console.log("window",o);const r=n.map(((e,t)=>e*o[t]));console.log("windowed",r);const i=be(r,10);console.log("lpc",i);const s=Be(i);console.log("polynomial",s),console.log("polynomial",s.map(((e,t)=>e.toFixed(5)+"*x^"+t)).join("+"));const a=Fe(s);console.log("roots",a);const l=a.filter((e=>e.imag>=0)).map((e=>Te(e)));console.log("fixedRoots",l);const c=ke(l,t);console.log("formants",c.map((e=>e.frequency.toFixed(0).padStart(4," "))).join(", "),"Hz",c)}([...i],r.sampleRate)}(t),e})()]}function Ue(e){e.recording=!1,e.synth.recordingBuffer.copyToChannel(e.sampleBuffer,0,0)}function Le(e){if(!e.recording)return;const t=e.synth.getWaveform(e.waveformBufferIndex).slice(0,e.sampleBuffer.length-e.recordingIndex);e.sampleBuffer.set(t,e.recordingIndex),e.recordingIndex+=t.length,e.waveformBufferIndex=e.synth.waveformBufferIndex,e.recordingIndex>=e.sampleBuffer.length?Ue(e):window.requestAnimationFrame((()=>Le(e)))}function je(e){if(!e.playing)return;const t=e.synth.ctx.currentTime-e.synth.recordingPlaybackStartTime;e.playingIndex=t*e.synth.ctx.sampleRate,e.playingIndex>=e.recordingIndex?e.playing=!1:window.requestAnimationFrame((()=>je(e)))}function Ve(e){window.requestAnimationFrame((()=>Ve(e))),function(e){const t=window.devicePixelRatio||1,n=e.getBoundingClientRect(),o=Math.round(t*n.right)-Math.round(t*n.left),r=Math.round(t*n.bottom)-Math.round(t*n.top);e.width=o,e.height=r}(e.canvas);const t=e.canvas.width,n=e.canvas.height;e.ctx.save(),e.ctx.translate(.5,.5),e.ctx.fillStyle="#eee",e.ctx.fillRect(0,0,t,n);const o=n=>n/e.sampleBuffer.length*(t-40)+20,r=e=>n/2-e*(n/2-10);e.ctx.strokeStyle="#000",e.ctx.lineWidth=1,e.ctx.beginPath(),e.ctx.moveTo(o(0),0),e.ctx.lineTo(o(0),n),e.ctx.moveTo(o(e.sampleBuffer.length),0),e.ctx.lineTo(o(e.sampleBuffer.length),n),e.ctx.stroke(),e.ctx.strokeStyle="#000",e.ctx.lineWidth=1,e.ctx.beginPath(),e.ctx.moveTo(o(0),r(0));for(let t=0;t<e.recordingIndex;t++){const n=e.sampleBuffer.at(t)??0;e.ctx.lineTo(o(t),r(n))}e.ctx.lineTo(o(e.recordingIndex),r(0)),e.ctx.lineTo(o(e.sampleBuffer.length),r(0)),e.ctx.stroke(),e.recording&&(e.ctx.strokeStyle="#f00",e.ctx.lineWidth=2,e.ctx.beginPath(),e.ctx.moveTo(o(e.recordingIndex),0),e.ctx.lineTo(o(e.recordingIndex),n),e.ctx.stroke()),e.playing&&(e.ctx.strokeStyle=se,e.ctx.lineWidth=2,e.ctx.beginPath(),e.ctx.moveTo(o(e.playingIndex),0),e.ctx.lineTo(o(e.playingIndex),n),e.ctx.stroke()),e.ctx.restore()}Q(["click"]);const He=H("<div>Click and drag around the top chart to synthesize vowel sounds via formant frequencies.<br><br>Red: extracted frequency-domain data from waveform<br>Blue: extracted formant frequencies from waveform<br><br><br><br> <button>Toggle Microphone");(function(e,t,n,o={}){let r;(function(e,t){const n=d,o=l,r=0===e.length,i=void 0===t?o:t,s=r?a:{owned:null,cleanups:null,context:i?i.context:null,owner:i},c=r?e:()=>e((()=>F((()=>$(s)))));l=s,d=null;try{return R(c,!0)}finally{d=n,l=o}})((o=>{r=o,t===document?e():X(t,e(),t.firstChild?null:void 0,n)}),o.owner)})((function(){const[e,t]=p(void 0);return te.create().then(t),L(j,{get when(){return!!e()},get children(){const t=He(),n=t.firstChild.nextSibling.nextSibling.nextSibling.nextSibling.nextSibling.nextSibling.nextSibling.nextSibling,o=n.nextSibling,r=o.nextSibling,i=r.nextSibling;return t.style.setProperty("width","min(700px, calc(100dvw - 2em))"),t.style.setProperty("height","100dvh"),t.style.setProperty("margin","auto"),t.style.setProperty("text-align","center"),X(t,L(fe,{get synth(){return e()}}),n),X(t,L(Ie,{get synth(){return e()}}),o),X(t,L(Oe,{get synth(){return e()}}),r),i.$$click=()=>e().toggleMic(),t}})}),document.getElementById("app")),Q(["click"])})();
//# sourceMappingURL=main.js.map